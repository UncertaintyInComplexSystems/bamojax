
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://uncertaintyincomplexsystems.github.io/bamojax/api/bamojax.modified_blackjax.modified_elliptical_slice_nd/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>bamojax.modified_blackjax.modified_elliptical_slice_nd - BaMoJAX</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#bamojaxmodified_blackjaxmodified_elliptical_slice_nd" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="BaMoJAX" class="md-header__button md-logo" aria-label="BaMoJAX" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BaMoJAX
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              bamojax.modified_blackjax.modified_elliptical_slice_nd
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/UncertaintyInComplexSystems/bamojax" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    UncertaintyInComplexSystems/bamojax
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="BaMoJAX" class="md-nav__button md-logo" aria-label="BaMoJAX" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    BaMoJAX
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/UncertaintyInComplexSystems/bamojax" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    UncertaintyInComplexSystems/bamojax
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#bamojax.modified_blackjax.modified_elliptical_slice_nd" class="md-nav__link">
    <span class="md-ellipsis">
      modified_elliptical_slice_nd
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bamojax.modified_blackjax.modified_elliptical_slice_nd.EllipSliceState" class="md-nav__link">
    <span class="md-ellipsis">
      EllipSliceState
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bamojax.modified_blackjax.modified_elliptical_slice_nd.EllipSliceInfo" class="md-nav__link">
    <span class="md-ellipsis">
      EllipSliceInfo
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bamojax.modified_blackjax.modified_elliptical_slice_nd.build_kernel" class="md-nav__link">
    <span class="md-ellipsis">
      build_kernel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="build_kernel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bamojax.modified_blackjax.modified_elliptical_slice_nd.build_kernel--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bamojax.modified_blackjax.modified_elliptical_slice_nd.build_kernel--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bamojax.modified_blackjax.modified_elliptical_slice_nd.as_top_level_api" class="md-nav__link">
    <span class="md-ellipsis">
      as_top_level_api
    </span>
  </a>
  
    <nav class="md-nav" aria-label="as_top_level_api">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bamojax.modified_blackjax.modified_elliptical_slice_nd.as_top_level_api--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bamojax.modified_blackjax.modified_elliptical_slice_nd.as_top_level_api--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bamojax.modified_blackjax.modified_elliptical_slice_nd.as_top_level_api--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bamojax.modified_blackjax.modified_elliptical_slice_nd.ellipsis" class="md-nav__link">
    <span class="md-ellipsis">
      ellipsis
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="bamojaxmodified_blackjaxmodified_elliptical_slice_nd"><code>bamojax.modified_blackjax.modified_elliptical_slice_nd</code><a class="headerlink" href="#bamojaxmodified_blackjaxmodified_elliptical_slice_nd" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="bamojax.modified_blackjax.modified_elliptical_slice_nd"></a>
    <div class="doc doc-contents first">

        <p>Public API for the Elliptical Slice sampling Kernel</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="bamojax.modified_blackjax.modified_elliptical_slice_nd.EllipSliceState" class="doc doc-heading">
            <code>EllipSliceState</code>


<a href="#bamojax.modified_blackjax.modified_elliptical_slice_nd.EllipSliceState" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.NamedTuple">NamedTuple</span></code></p>


        <p>State of the Elliptical Slice sampling algorithm.</p>
<p>position
    Current position of the chain.
logdensity
    Current value of the logdensity (evaluated at current position).</p>








              <details class="quote">
                <summary>Source code in <code>bamojax/modified_blackjax/modified_elliptical_slice_nd.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EllipSliceState</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;State of the Elliptical Slice sampling algorithm.</span>

<span class="sd">    position</span>
<span class="sd">        Current position of the chain.</span>
<span class="sd">    logdensity</span>
<span class="sd">        Current value of the logdensity (evaluated at current position).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">position</span><span class="p">:</span> <span class="n">ArrayTree</span>
    <span class="n">logdensity</span><span class="p">:</span> <span class="n">ArrayTree</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="bamojax.modified_blackjax.modified_elliptical_slice_nd.EllipSliceInfo" class="doc doc-heading">
            <code>EllipSliceInfo</code>


<a href="#bamojax.modified_blackjax.modified_elliptical_slice_nd.EllipSliceInfo" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.NamedTuple">NamedTuple</span></code></p>


        <p>Additional information on the Elliptical Slice sampling chain.</p>
<p>This additional information can be used for debugging or computing
diagnostics.</p>
<p>momentum
    The latent momentum variable returned at the end of the transition.
theta
    A value between [-2\pi, 2\pi] identifying points in the ellipsis drawn
    from the positon and mommentum variables. This value indicates the theta
    value of the accepted proposal.
subiter
    Number of sub iterations needed to accept a proposal. The more subiterations
    needed the less efficient the algorithm will be, and the more dependent the
    new value is likely to be to the previous value.</p>








              <details class="quote">
                <summary>Source code in <code>bamojax/modified_blackjax/modified_elliptical_slice_nd.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EllipSliceInfo</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Additional information on the Elliptical Slice sampling chain.</span>

<span class="sd">    This additional information can be used for debugging or computing</span>
<span class="sd">    diagnostics.</span>

<span class="sd">    momentum</span>
<span class="sd">        The latent momentum variable returned at the end of the transition.</span>
<span class="sd">    theta</span>
<span class="sd">        A value between [-2\pi, 2\pi] identifying points in the ellipsis drawn</span>
<span class="sd">        from the positon and mommentum variables. This value indicates the theta</span>
<span class="sd">        value of the accepted proposal.</span>
<span class="sd">    subiter</span>
<span class="sd">        Number of sub iterations needed to accept a proposal. The more subiterations</span>
<span class="sd">        needed the less efficient the algorithm will be, and the more dependent the</span>
<span class="sd">        new value is likely to be to the previous value.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">momentum</span><span class="p">:</span> <span class="n">ArrayTree</span>
    <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">subiter</span><span class="p">:</span> <span class="nb">int</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="bamojax.modified_blackjax.modified_elliptical_slice_nd.build_kernel" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_kernel</span><span class="p">(</span><span class="n">cov_matrix</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">nd</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#bamojax.modified_blackjax.modified_elliptical_slice_nd.build_kernel" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Build an Elliptical Slice sampling kernel :cite:p:<code>murray2010elliptical</code>.</p>
<h4 id="bamojax.modified_blackjax.modified_elliptical_slice_nd.build_kernel--parameters">Parameters<a class="headerlink" href="#bamojax.modified_blackjax.modified_elliptical_slice_nd.build_kernel--parameters" title="Permanent link">&para;</a></h4>
<p>cov_matrix
    The value of the covariance matrix of the gaussian prior distribution from
    the posterior we wish to sample.</p>
<h4 id="bamojax.modified_blackjax.modified_elliptical_slice_nd.build_kernel--returns">Returns<a class="headerlink" href="#bamojax.modified_blackjax.modified_elliptical_slice_nd.build_kernel--returns" title="Permanent link">&para;</a></h4>
<p>A kernel that takes a rng_key and a Pytree that contains the current state
of the chain and that returns a new state of the chain along with
information about the transition.</p>


            <details class="quote">
              <summary>Source code in <code>bamojax/modified_blackjax/modified_elliptical_slice_nd.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_kernel</span><span class="p">(</span><span class="n">cov_matrix</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span> <span class="n">mean</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span> <span class="n">nd</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build an Elliptical Slice sampling kernel :cite:p:`murray2010elliptical`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cov_matrix</span>
<span class="sd">        The value of the covariance matrix of the gaussian prior distribution from</span>
<span class="sd">        the posterior we wish to sample.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A kernel that takes a rng_key and a Pytree that contains the current state</span>
<span class="sd">    of the chain and that returns a new state of the chain along with</span>
<span class="sd">    information about the transition.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ndim</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">cov_matrix</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">cov_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">d</span><span class="p">,</span> <span class="n">nu</span> <span class="o">=</span> <span class="n">nd</span>        
        <span class="n">flat_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="o">*</span><span class="n">nu</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">nu</span> <span class="o">=</span> <span class="n">nd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">flat_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">nu</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Elliptical slice sampling is not implemented for nd = </span><span class="si">{</span><span class="n">nd</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># diagonal covariance matrix</span>
        <span class="n">cov_matrix_sqrt</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cov_matrix</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">cov_matrix_sqrt</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cholesky</span><span class="p">(</span><span class="n">cov_matrix</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The mass matrix has the wrong number of dimensions:&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; expected 1 or 2, got </span><span class="si">{</span><span class="n">jnp</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">cov_matrix</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>  <span class="c1"># type: ignore[arg-type]</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_flat</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree_util</span><span class="o">.</span><span class="n">tree_map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">flat_shape</span><span class="p">),</span> <span class="n">u</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_nd</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree_util</span><span class="o">.</span><span class="n">tree_map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">nd</span> <span class="o">+</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="p">)),</span> <span class="n">u</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">momentum_generator</span><span class="p">(</span><span class="n">rng_key</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
        <span class="n">generate_noise_fn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n">generate_gaussian_noise</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">cov_matrix_sqrt</span><span class="p">)</span>
        <span class="c1"># [MODIFICATIONS] vmap the noise generation over the dimensions nd, then reshape into flattened array</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">to_nd</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">d</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">nu</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">generate_noise_fn</span><span class="p">(</span><span class="n">rng_key</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">d</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">nu</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">keys_d</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">rng_key</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">generate_noise_fn</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))(</span><span class="n">keys_d</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">d</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">nu</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">keys_nu</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">rng_key</span><span class="p">,</span> <span class="n">nu</span><span class="p">)</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">generate_noise_fn</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))(</span><span class="n">keys_nu</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">d</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">nu</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">keys_d</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">rng_key</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
            <span class="n">keys_dnu</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">nu</span><span class="p">))(</span><span class="n">keys_d</span><span class="p">)</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">generate_noise_fn</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))(</span><span class="n">keys_dnu</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="n">z_reshaped</span> <span class="o">=</span> <span class="n">to_flat</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">z_reshaped</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">elliptical_proposal</span><span class="p">(</span>
        <span class="n">logdensity_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
        <span class="n">momentum_generator</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
        <span class="n">mean</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build an Ellitpical slice sampling kernel.</span>

<span class="sd">        The algorithm samples a latent parameter, traces an ellipse connecting the</span>
<span class="sd">        initial position and the latent parameter and does slice sampling on this</span>
<span class="sd">        ellipse to output a new sample from the posterior distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        logdensity_fn</span>
<span class="sd">            A function that returns the log-likelihood at a given position.</span>
<span class="sd">        momentum_generator</span>
<span class="sd">            A function that generates a new latent momentum variable.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A kernel that takes a rng_key and a Pytree that contains the current state</span>
<span class="sd">        of the chain and that returns a new state of the chain along with</span>
<span class="sd">        information about the transition.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">num_el</span> <span class="o">=</span> <span class="n">d</span><span class="o">*</span><span class="n">nu</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">reps</span><span class="o">=</span><span class="n">num_el</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span>
            <span class="n">rng_key</span><span class="p">:</span> <span class="n">PRNGKey</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">EllipSliceState</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">EllipSliceState</span><span class="p">,</span> <span class="n">EllipSliceInfo</span><span class="p">]:</span>
            <span class="n">position</span><span class="p">,</span> <span class="n">logdensity</span> <span class="o">=</span> <span class="n">state</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">to_flat</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
            <span class="n">key_slice</span><span class="p">,</span> <span class="n">key_momentum</span><span class="p">,</span> <span class="n">key_uniform</span><span class="p">,</span> <span class="n">key_theta</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">rng_key</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="c1"># step 1: sample momentum</span>
            <span class="n">momentum</span> <span class="o">=</span> <span class="n">momentum_generator</span><span class="p">(</span><span class="n">key_momentum</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span> 
            <span class="c1"># step 2: get slice (y)</span>
            <span class="n">logy</span> <span class="o">=</span> <span class="n">logdensity</span> <span class="o">+</span> <span class="n">jnp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">key_uniform</span><span class="p">))</span>
            <span class="c1"># step 3: get theta (ellipsis move), set inital interval</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">key_theta</span><span class="p">)</span>
            <span class="n">theta_min</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">theta_max</span> <span class="o">=</span> <span class="n">theta</span>
            <span class="c1"># step 4: proposal</span>
            <span class="n">p</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">ellipsis</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">momentum</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">mean</span><span class="p">)</span>
            <span class="c1"># step 5: acceptance</span>
            <span class="n">logdensity</span> <span class="o">=</span> <span class="n">logdensity_fn</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">slice_fn</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;Perform slice sampling around the ellipsis.</span>

<span class="sd">                Checks if the proposed position&#39;s likelihood is larger than the slice</span>
<span class="sd">                variable. Returns the position if True, shrinks the bracket for sampling</span>
<span class="sd">                `theta` and samples a new proposal if False.</span>

<span class="sd">                As the bracket `[theta_min, theta_max]` shrinks, the proposal gets closer</span>
<span class="sd">                to the original position, which has likelihood larger than the slice variable.</span>
<span class="sd">                It is guaranteed to stop in a finite number of iterations as long as the</span>
<span class="sd">                likelihood is continuous with respect to the parameter being sampled.</span>

<span class="sd">                &quot;&quot;&quot;</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">subiter</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">theta_min</span><span class="p">,</span> <span class="n">theta_max</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">vals</span>
                <span class="n">thetak</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">fold_in</span><span class="p">(</span><span class="n">key_slice</span><span class="p">,</span> <span class="n">subiter</span><span class="p">)</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">thetak</span><span class="p">,</span> <span class="n">minval</span><span class="o">=</span><span class="n">theta_min</span><span class="p">,</span> <span class="n">maxval</span><span class="o">=</span><span class="n">theta_max</span><span class="p">)</span>
                <span class="n">p</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">ellipsis</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">momentum</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">mean</span><span class="p">)</span>
                <span class="n">logdensity</span> <span class="o">=</span> <span class="n">logdensity_fn</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="n">theta_min</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">theta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">theta_min</span><span class="p">)</span>
                <span class="n">theta_max</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">theta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">theta_max</span><span class="p">)</span>
                <span class="n">subiter</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">return</span> <span class="n">logdensity</span><span class="p">,</span> <span class="n">subiter</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">theta_min</span><span class="p">,</span> <span class="n">theta_max</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">m</span>

            <span class="n">logdensity</span><span class="p">,</span> <span class="n">subiter</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">momentum</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">while_loop</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">vals</span><span class="p">:</span> <span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">logy</span><span class="p">,</span>
                <span class="n">slice_fn</span><span class="p">,</span>
                <span class="p">(</span><span class="n">logdensity</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">theta_min</span><span class="p">,</span> <span class="n">theta_max</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">to_nd</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">EllipSliceState</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">logdensity</span><span class="p">),</span>
                <span class="n">EllipSliceInfo</span><span class="p">(</span><span class="n">momentum</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">subiter</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">generate</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">kernel</span><span class="p">(</span>
        <span class="n">rng_key</span><span class="p">:</span> <span class="n">PRNGKey</span><span class="p">,</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">EllipSliceState</span><span class="p">,</span>
        <span class="n">logdensity_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">EllipSliceState</span><span class="p">,</span> <span class="n">EllipSliceInfo</span><span class="p">]:</span>
        <span class="n">proposal_generator</span> <span class="o">=</span> <span class="n">elliptical_proposal</span><span class="p">(</span>
            <span class="n">logdensity_fn</span><span class="p">,</span> <span class="n">momentum_generator</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> 
        <span class="p">)</span>       
        <span class="k">return</span> <span class="n">proposal_generator</span><span class="p">(</span><span class="n">rng_key</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">kernel</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bamojax.modified_blackjax.modified_elliptical_slice_nd.as_top_level_api" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">as_top_level_api</span><span class="p">(</span><span class="n">loglikelihood_fn</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">nd</span><span class="p">)</span></code>

<a href="#bamojax.modified_blackjax.modified_elliptical_slice_nd.as_top_level_api" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Implements the (basic) user interface for the Elliptical Slice sampling kernel.</p>
<h4 id="bamojax.modified_blackjax.modified_elliptical_slice_nd.as_top_level_api--examples">Examples<a class="headerlink" href="#bamojax.modified_blackjax.modified_elliptical_slice_nd.as_top_level_api--examples" title="Permanent link">&para;</a></h4>
<p>A new Elliptical Slice sampling kernel can be initialized and used with the following code:</p>
<p>.. code::</p>
<pre><code>ellip_slice = blackjax.elliptical_slice(loglikelihood_fn, cov_matrix)
state = ellip_slice.init(position)
new_state, info = ellip_slice.step(rng_key, state)
</code></pre>
<p>We can JIT-compile the step function for better performance</p>
<p>.. code::</p>
<pre><code>step = jax.jit(ellip_slice.step)
new_state, info = step(rng_key, state)
</code></pre>
<h4 id="bamojax.modified_blackjax.modified_elliptical_slice_nd.as_top_level_api--parameters">Parameters<a class="headerlink" href="#bamojax.modified_blackjax.modified_elliptical_slice_nd.as_top_level_api--parameters" title="Permanent link">&para;</a></h4>
<p>loglikelihood_fn
    Only the log likelihood function from the posterior distributon we wish to sample.
cov_matrix
    The value of the covariance matrix of the gaussian prior distribution from the posterior we wish to sample.</p>
<h4 id="bamojax.modified_blackjax.modified_elliptical_slice_nd.as_top_level_api--returns">Returns<a class="headerlink" href="#bamojax.modified_blackjax.modified_elliptical_slice_nd.as_top_level_api--returns" title="Permanent link">&para;</a></h4>
<p>A <code>SamplingAlgorithm</code>.</p>


            <details class="quote">
              <summary>Source code in <code>bamojax/modified_blackjax/modified_elliptical_slice_nd.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">as_top_level_api</span><span class="p">(</span>
    <span class="n">loglikelihood_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">mean</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
    <span class="n">cov</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
    <span class="n">nd</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SamplingAlgorithm</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implements the (basic) user interface for the Elliptical Slice sampling kernel.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    A new Elliptical Slice sampling kernel can be initialized and used with the following code:</span>

<span class="sd">    .. code::</span>

<span class="sd">        ellip_slice = blackjax.elliptical_slice(loglikelihood_fn, cov_matrix)</span>
<span class="sd">        state = ellip_slice.init(position)</span>
<span class="sd">        new_state, info = ellip_slice.step(rng_key, state)</span>

<span class="sd">    We can JIT-compile the step function for better performance</span>

<span class="sd">    .. code::</span>

<span class="sd">        step = jax.jit(ellip_slice.step)</span>
<span class="sd">        new_state, info = step(rng_key, state)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    loglikelihood_fn</span>
<span class="sd">        Only the log likelihood function from the posterior distributon we wish to sample.</span>
<span class="sd">    cov_matrix</span>
<span class="sd">        The value of the covariance matrix of the gaussian prior distribution from the posterior we wish to sample.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A ``SamplingAlgorithm``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kernel</span> <span class="o">=</span> <span class="n">build_kernel</span><span class="p">(</span><span class="n">cov</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">nd</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">init_fn</span><span class="p">(</span><span class="n">position</span><span class="p">:</span> <span class="n">ArrayLikeTree</span><span class="p">,</span> <span class="n">rng_key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">del</span> <span class="n">rng_key</span>
        <span class="k">return</span> <span class="n">init</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">loglikelihood_fn</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">step_fn</span><span class="p">(</span><span class="n">rng_key</span><span class="p">:</span> <span class="n">PRNGKey</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">kernel</span><span class="p">(</span>
            <span class="n">rng_key</span><span class="p">,</span>
            <span class="n">state</span><span class="p">,</span>
            <span class="n">loglikelihood_fn</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">SamplingAlgorithm</span><span class="p">(</span><span class="n">init_fn</span><span class="p">,</span> <span class="n">step_fn</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bamojax.modified_blackjax.modified_elliptical_slice_nd.ellipsis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ellipsis</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">momentum</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">mean</span><span class="p">)</span></code>

<a href="#bamojax.modified_blackjax.modified_elliptical_slice_nd.ellipsis" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generate proposal from the ellipsis.</p>
<p>Given a scalar theta indicating a point on the circumference of the ellipsis
and the shared mean vector for both position and momentum variables,
generate proposed position and momentum to later accept or reject
depending on the slice variable.</p>


            <details class="quote">
              <summary>Source code in <code>bamojax/modified_blackjax/modified_elliptical_slice_nd.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ellipsis</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">momentum</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">mean</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate proposal from the ellipsis.</span>

<span class="sd">    Given a scalar theta indicating a point on the circumference of the ellipsis</span>
<span class="sd">    and the shared mean vector for both position and momentum variables,</span>
<span class="sd">    generate proposed position and momentum to later accept or reject</span>
<span class="sd">    depending on the slice variable.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">position</span><span class="p">,</span> <span class="n">unravel_fn</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">flatten_util</span><span class="o">.</span><span class="n">ravel_pytree</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
    <span class="n">momentum</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">flatten_util</span><span class="o">.</span><span class="n">ravel_pytree</span><span class="p">(</span><span class="n">momentum</span><span class="p">)</span>
    <span class="n">position_centered</span> <span class="o">=</span> <span class="n">position</span> <span class="o">-</span> <span class="n">mean</span>
    <span class="n">momentum_centered</span> <span class="o">=</span> <span class="n">momentum</span> <span class="o">-</span> <span class="n">mean</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">unravel_fn</span><span class="p">(</span>
            <span class="n">position_centered</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">momentum_centered</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">mean</span>
        <span class="p">),</span>
        <span class="n">unravel_fn</span><span class="p">(</span>
            <span class="n">momentum_centered</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="o">-</span> <span class="n">position_centered</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">mean</span>
        <span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "navigation.top", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>